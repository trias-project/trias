<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Apply GAM to time series and assess emerging status — apply_gam • trias</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Apply GAM to time series and assess emerging status — apply_gam"><meta property="og:description" content="This function applies generalized additive models (GAM) to assess emerging
status for a certain time window."><meta property="og:image" content="https://trias-project.github.io/trias/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trias</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/trias-project/trias/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Apply GAM to time series and assess emerging status</h1>
    <small class="dont-index">Source: <a href="https://github.com/trias-project/trias/blob/HEAD/R/apply_gam.R" class="external-link"><code>R/apply_gam.R</code></a></small>
    <div class="hidden name"><code>apply_gam.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function applies generalized additive models (GAM) to assess emerging
status for a certain time window.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">apply_gam</span><span class="op">(</span>
  <span class="va">df</span>,
  <span class="va">y_var</span>,
  <span class="va">eval_years</span>,
  year <span class="op">=</span> <span class="st">"year"</span>,
  taxonKey <span class="op">=</span> <span class="st">"taxonKey"</span>,
  type_indicator <span class="op">=</span> <span class="st">"observations"</span>,
  baseline_var <span class="op">=</span> <span class="cn">NULL</span>,
  p_max <span class="op">=</span> <span class="fl">0.1</span>,
  taxon_key <span class="op">=</span> <span class="cn">NULL</span>,
  name <span class="op">=</span> <span class="cn">NULL</span>,
  df_title <span class="op">=</span> <span class="cn">NULL</span>,
  x_label <span class="op">=</span> <span class="st">"year"</span>,
  y_label <span class="op">=</span> <span class="st">"Observations"</span>,
  saveplot <span class="op">=</span> <span class="cn">FALSE</span>,
  dir_name <span class="op">=</span> <span class="cn">NULL</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df</dt>
<dd><p>df. A dataframe containing temporal data.</p></dd>
<dt>y_var</dt>
<dd><p>character. Name of column containing variable to model. It has
to be passed as string, e.g. <code>"occurrences"</code>.</p></dd>
<dt>eval_years</dt>
<dd><p>numeric. Temporal value(s) when emerging status has to be
evaluated.</p></dd>
<dt>year</dt>
<dd><p>character. Name of column containing temporal values. It has to
be passed as string, e.g. <code>"time"</code>. Default: <code>"year"</code>.</p></dd>
<dt>taxonKey</dt>
<dd><p>character. Name of column containing taxon IDs. It has to be
passed as string, e.g. <code>"taxon"</code>. Default: <code>"taxonKey"</code>.</p></dd>
<dt>type_indicator</dt>
<dd><p>character. One of <code>"observations"</code>,
<code>"occupancy"</code>. Used in title of the output plot. Default:
<code>"observations"</code>.</p></dd>
<dt>baseline_var</dt>
<dd><p>character. Name of the column containing values to use
as additional covariate. Such covariate is introduced in the model to
correct research effort bias. Default: <code>NULL</code>. If <code>NULL</code> internal
variable <code>method_em = "basic"</code>, otherwise <code>method_em =
  "correct_baseline"</code>. Value of <code>method_em</code> will be part of title of
output plot.</p></dd>
<dt>p_max</dt>
<dd><p>numeric. A value between 0 and 1. Default: 0.1.</p></dd>
<dt>taxon_key</dt>
<dd><p>numeric, character. Taxon key the timeseries belongs to.
Used exclusively in graph title and filename (if <code>saveplot = TRUE</code>).
Default: <code>NULL</code>.</p></dd>
<dt>name</dt>
<dd><p>character. Species name the timeseries belongs to. Used
exclusively in graph title and filename (if <code>saveplot = TRUE</code>).
Default: <code>NULL</code>.</p></dd>
<dt>df_title</dt>
<dd><p>character. Any string you would like to add to graph titles
and filenames (if <code>saveplot = TRUE</code>). The title is always composed of:
<code>"GAM"</code> + <code>type_indicator</code> + <code>method_em</code> + <code>taxon_key</code></p><ul><li><p><code>name</code> + <code>df_title</code> separated by underscore ("_"). Default:
<code>NULL</code>.</p></li>
</ul></dd>
<dt>x_label</dt>
<dd><p>character. x-axis label of output plot. Default:
<code>"year"</code>.</p></dd>
<dt>y_label</dt>
<dd><p>character. y-axis label of output plot. Default:
<code>"number of observations"</code>.</p></dd>
<dt>saveplot</dt>
<dd><p>logical. If <code>TRUE</code> the plots are authomatically saved.
Default: <code>FALSE</code>.</p></dd>
<dt>dir_name</dt>
<dd><p>character. Path of directory where saving plots. If path
doesn't exists, directory will be created. Example: "./output/graphs/". If
<code>NULL</code>, plots are saved in current directory. Default: <code>NULL</code>.</p></dd>
<dt>verbose</dt>
<dd><p>logical. If <code>TRUE</code> status of processing and possible
issues are returned. Default: <code>FALSE</code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>list. List with six objects:</p><ul><li><p><code>model</code>: gam
object. The model as returned by GAM.</p></li>
<li><p><code>first_derivative</code>: df.
Data.frame with details of first derivatives. It contains following
columns: </p><ul><li><p><code>var</code>: character. Column name the smoother is
applied to.</p></li>
<li><p><code>data</code>: numeric. Data in columns defined by
<code>var</code>.</p></li>
<li><p><code>derivative</code>: numeric. Value of first derivative.</p></li>
<li><p><code>se</code>: numeric. Standard error of <code>derivative</code>.</p></li>
<li><p><code>crit</code>: numeric. Critical value required such that
<code>derivative + (se * crit)</code> and <code>derivative - (se * crit)</code> form
the upper and lower bounds of the confidence interval on the first
derivative of the estimated smooth at the specific confidence level. In our
case the confidence level is hard-coded: 0.8. Then <code>crit &lt;- qnorm(p =
  (1-0.8)/2, mean = 0, sd = 1, lower.tail = FALSE)</code>.</p></li>
<li><p><code>lower</code>: numeric. Lower bound of the confidence interval of the
estimated smooth.</p></li>
<li><p><code>upper</code>: numeric. Upper bound of the
confidence interval of the estimated smooth.</p></li>
</ul></li>
<li><p><code>second_derivative</code>: df. Data.frame with details of second
derivatives. Same columns as <code>first_derivatives</code>.</p></li>
<li><p><code>plot</code>:
a ggplot2 object. Plot of GAM output and emerging. <code>NULL</code> if GAM
cannot be applied.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">df_gam</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span class="r-in">  taxonKey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3003709</span>, <span class="fl">24</span><span class="op">)</span>,</span>
<span class="r-in">  canonicalName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Rosa glauca"</span>, <span class="fl">24</span><span class="op">)</span>,</span>
<span class="r-in">  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1995</span>, <span class="fl">2018</span><span class="op">)</span>,</span>
<span class="r-in">  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span class="r-in">    <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span>,</span>
<span class="r-in">    <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">10</span></span>
<span class="r-in">  <span class="op">)</span>,</span>
<span class="r-in">  n_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span class="r-in">    <span class="fl">229</span>, <span class="fl">555</span>, <span class="fl">1116</span>, <span class="fl">939</span>, <span class="fl">919</span>, <span class="fl">853</span>, <span class="fl">442</span>, <span class="fl">532</span>, <span class="fl">623</span>, <span class="fl">1178</span>, <span class="fl">732</span>, <span class="fl">371</span>, <span class="fl">1053</span>,</span>
<span class="r-in">    <span class="fl">1001</span>, <span class="fl">1550</span>, <span class="fl">1142</span>, <span class="fl">1076</span>, <span class="fl">1310</span>, <span class="fl">922</span>, <span class="fl">1773</span>, <span class="fl">1637</span>,</span>
<span class="r-in">    <span class="fl">1866</span>, <span class="fl">2234</span>, <span class="fl">2013</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="co"># apply GAM to n without baseline as covariate</span></span>
<span class="r-in"><span class="fu">apply_gam</span><span class="op">(</span><span class="va">df_gam</span>,</span>
<span class="r-in">  y_var <span class="op">=</span> <span class="st">"n"</span>,</span>
<span class="r-in">  eval_years <span class="op">=</span> <span class="fl">2018</span>,</span>
<span class="r-in">  taxon_key <span class="op">=</span> <span class="fl">3003709</span>,</span>
<span class="r-in">  name <span class="op">=</span> <span class="st">"Rosa glauca"</span>,</span>
<span class="r-in">  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="co"># apply GAM using baseline data in column n_class as covariate</span></span>
<span class="r-in"><span class="fu">apply_gam</span><span class="op">(</span><span class="va">df_gam</span>,</span>
<span class="r-in">  y_var <span class="op">=</span> <span class="st">"n"</span>,</span>
<span class="r-in">  eval_years <span class="op">=</span> <span class="fl">2018</span>,</span>
<span class="r-in">  baseline_var <span class="op">=</span> <span class="st">"n_class"</span>,</span>
<span class="r-in">  taxon_key <span class="op">=</span> <span class="fl">3003709</span>,</span>
<span class="r-in">  name <span class="op">=</span> <span class="st">"Rosa glauca"</span>,</span>
<span class="r-in">  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="co"># apply GAM using n as occupancy values, evaluate on two years. No baseline</span></span>
<span class="r-in"><span class="fu">apply_gam</span><span class="op">(</span><span class="va">df_gam</span>,</span>
<span class="r-in">  y_var <span class="op">=</span> <span class="st">"n"</span>,</span>
<span class="r-in">  eval_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2017</span>, <span class="fl">2018</span><span class="op">)</span>,</span>
<span class="r-in">  taxon_key <span class="op">=</span> <span class="fl">3003709</span>,</span>
<span class="r-in">  type_indicator <span class="op">=</span> <span class="st">"occupancy"</span>,</span>
<span class="r-in">  name <span class="op">=</span> <span class="st">"Rosa glauca"</span>,</span>
<span class="r-in">  y_label <span class="op">=</span> <span class="st">"occupancy"</span>,</span>
<span class="r-in">  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="co"># apply GAM using n as occupancy values and n_class as covariate (baseline)</span></span>
<span class="r-in"><span class="fu">apply_gam</span><span class="op">(</span><span class="va">df_gam</span>,</span>
<span class="r-in">  y_var <span class="op">=</span> <span class="st">"n"</span>,</span>
<span class="r-in">  eval_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2017</span>, <span class="fl">2018</span><span class="op">)</span>,</span>
<span class="r-in">  baseline_var <span class="op">=</span> <span class="st">"n_class"</span>,</span>
<span class="r-in">  taxon_key <span class="op">=</span> <span class="fl">3003709</span>,</span>
<span class="r-in">  type_indicator <span class="op">=</span> <span class="st">"occupancy"</span>,</span>
<span class="r-in">  name <span class="op">=</span> <span class="st">"Rosa glauca"</span>,</span>
<span class="r-in">  y_label <span class="op">=</span> <span class="st">"occupancy"</span>,</span>
<span class="r-in">  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="co"># How to use other arguments</span></span>
<span class="r-in"><span class="fu">apply_gam</span><span class="op">(</span><span class="va">df_gam</span>,</span>
<span class="r-in">  y_var <span class="op">=</span> <span class="st">"n"</span>,</span>
<span class="r-in">  eval_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2017</span>, <span class="fl">2018</span><span class="op">)</span>,</span>
<span class="r-in">  baseline_var <span class="op">=</span> <span class="st">"n_class"</span>,</span>
<span class="r-in">  p_max <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span class="r-in">  taxon_key <span class="op">=</span> <span class="st">"3003709"</span>,</span>
<span class="r-in">  type_indicator <span class="op">=</span> <span class="st">"occupancy"</span>,</span>
<span class="r-in">  name <span class="op">=</span> <span class="st">"Rosa glauca"</span>,</span>
<span class="r-in">  df_title <span class="op">=</span> <span class="st">"Belgium"</span>,</span>
<span class="r-in">  x_label <span class="op">=</span> <span class="st">"time (years)"</span>,</span>
<span class="r-in">  y_label <span class="op">=</span> <span class="st">"area of occupancy (km2)"</span>,</span>
<span class="r-in">  saveplot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span class="r-in">  dir_name <span class="op">=</span> <span class="st">"./data/"</span>,</span>
<span class="r-in">  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://twitter.com/damianozingaro" class="external-link">Damiano Oldoni</a>, <a href="https://twitter.com/peterdesmet" class="external-link">Peter Desmet</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

